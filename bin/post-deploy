#!/bin/sh

set -e

if [ $# -lt 1 -o $# -gt 2 ]; then
    echo "Usage: $0 target [service]"
    exit 1
fi

if [ -f "$1/requirements.txt" -a -x "$1/manage.py" ]; then
    # Django
    [ -f "$1/env.sh" ] && . $1/env.sh
    pip install ${PYTHONUSERBASE+--user} -q -r $1/requirements.txt
    $1/manage.py migrate
    $1/manage.py collectstatic --no-input

else
    echo "post-deploy: Can't determine project type!"
fi

[ -n "$2" ] && restart-service $2
